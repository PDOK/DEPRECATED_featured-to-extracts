# DEPRECATED

# Featured-to-Extracts [![Build Status](https://travis-ci.org/PDOK/featured-to-extracts.svg?branch=master)](https://travis-ci.org/PDOK/featured-to-extracts)

Open-source extract generation software for Featured, developed by Publieke Dienstverlening op de Kaart (PDOK).

Featured-to-Extracts is one of the output applications in the PDOK ETL landscape.
It fills a database with XML snippets that are used to serve dynamic geodata downloads to end users.
The input is a list of changelog files generated by Featured (<https://github.com/PDOK/featured>) and a set of Mustache
templates (<https://mustache.github.io/>).

## Usage

Featured-to-Extracts supports a server mode and a command-line mode.
To run it locally, the following command can be used to start it in server mode:

    $ lein ring server-headless

To use the command line locally, use:

    $ lein run [args]

or

    $ lein uberjar
    $ java -jar featured-to-extracts-1.0.2-standalone.jar [args]

## Options

Featured-to-Extracts supports the following environment variables in server and command-line mode:

| Variable | Description |
|---|---|
| -Ddatabase_url="//localhost:5432/pdok" | |
| -Ddatabase_user="postgres" | |
| -Ddatabase_password="postgres" | |
| -Dextracts_schema="extractmanagement" | Database schema. |
| -Dn_workers=2 | Number of parallel workers. |

## Examples

### Command-line interface

#### Generate extracts
    $ lein run <path to templates dir> <dataset> <extract type> <path to changelog file>

Example:

    $ lein run ../catalogus/datasets/bgt/templates bgt citygml 1503305276223-bgt-bak.changelog

### REST API

#### Register templates
POST on `<context root>/api/template`. All parameters are mandatory.

    {
      "dataset": "<dataset>",
      "extractType": "<extract type>",
      "templateName": <template name>,
      "template": "<Mustache template>"
    }

#### Generate extracts
POST on `<context root>/api/process`. Parameters _format_ and _callback_ are optional.

    {
      "dataset": "<dataset>",
      "changeLog": "<URI to changelog>",
      "format": "zip/csv",
      "extractTypes": ["<extractType1>", "<extractType2>", ...],
      "callback": "<URI to callback>"
    }

## License

Copyright Â© 2016-2017 Publieke Dienstverlening op de Kaart

Distributed under the Eclipse Public License either version 1.0 or (at your option) any later version.
